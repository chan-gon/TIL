# 프로세스 관리

운영체제에서 프로그램을 실행 시키면 해당 프로그램이 메모리에 올라가서 프로세스가 되는데, 조금 더 자세히 말하자면, 프로세스 주소 공간(Process Address Space)이 메모리에 할당된다.

**프로그램 실행 -> 프로세스가 메모리에 올라감** 이 과정을 좀 더 세부정으로 바라보면 다음과 같다.

1. 프로그램 실행

2. 가상 메모리(Virtual Memory)에서 프로세스 생성

3. 가상 메모리의 프로세스는 주소 변환(Address Transition)을 통해 물리 메모리(Physical Memory)에 저장된다.

프로그램의 가상 메모리는 Code, Data, Stack 세 부분으로 구성되어 있다.

- Code: 실행 파일의 코드를 관리하는 부분. CPU에서 수행할 기계어들이 여기에 있다.

- Data: 전역변수나 프로그램의 시작-종료 시점까지 남아있는 데이터를 관리한다.

- Stack: 함수나 지역변수를 관리한다.

## 프로세스의 개념

프로세스는 **실행 중인 프로그램(Program in execution)** 이라고 할 수 있다.

프로세스는 문맥(Context) 이라는 것을 가지고 있는데, 해당 프로세스가 현재 어떤 상태에 있는가를 나타낸다.  
문맥에 영향을 미치는 요소는 다양하다. CPU 및 메모리 사용 정도, 파일을 몇 개 열어놓고 사용 했는가/하고 있는가 등등 매우 다양하다.  

## 프로세스의 상태

프로세스는 상태(state)가 변경되며 수행된다.

- Running: CPU를 잡고 instruction을 수행중인 상태

- Ready: CPU를 기다리는 상태(메모리 등 다른 조건을 모두 만족. CPU 사용을 위한 모든 준비가 끝난 상태)

- Blocked(wait, sleep)
    - CPU를 잡아도 당장 instruction을 수행할 수 없는 상태
    - 프로세스 자신이 요청한 event(예: I/O)가 즉시 만족되지 않아 이를 기다리는 상태
    - ex) 디스크에서 파일을 읽어와야 하는 경우(디스크에서 파일을 읽는 것은 오래 걸리는 작업이기 때문에 CPU를 잡아도 무의미함)

- New: 프로세스가 생성중인 상태

- Terminated: 수행(execution)이 끝난 상태

## 문맥 교환(Context Switch)

- CPU를 한 프로세스에서 다른 프로세스로 넘겨주는 과정
- 오버헤드가 많은 작업(컨텍스트 save/load에 따른 자원 소모)

CPU가 다른 프로세스에게 넘어갈 때 운영체제는 다음을 수행한다.

- CPU를 내어주는 프로세스의 상태를 그 프로세스의 PCB에 저장
- CPU를 새롭게 얻는 프로세스의 상태를 PCB에서 읽어옴

PCB에 CPU를 넘겨주기 전 프로세스의 마지막 상태 정보를 저장했다가, 다음에 다시 해당 프로세스가 CPU를 가져오면 PCB에 저장된 상태 정보를 가지고 이어서 프로세스가 실행된다.

PCB: 운영체제가 각 프로세스를 관리하기 위해 프로세스당 유지하는 정보. 구성요소는 아래와 같다.  
- OS가 관리상 사용하는 정보  
- CPU 수행 관련 하드웨어 값(Program counter, registers)  
- 메모리 관련(Code, Data, Stack의 위치 정보)
- 파일 관련

## 스레드

프로세스 중에서 CPU 수행 단위를 스레드라고 부른다. 가벼운 프로세스(lightweight process) 라고도 부른다.

만약 스레드 개념 없이 프로세스 개념만 가지고 컴퓨터를 사용하면, 사용자가 실행하는 모든 프로그램이 프로세스로 관리된다. 동일한 프로그램 여러개를 실행해서 사용한다고 해도 실행한 각각의 프로그램이 프로세스로 관리된다. 이는 대단히 비효율적이다.

스레드는 프로세스 내부의 실행 단위라고 볼 수 있다. 좀 더 자세히 말하면, 초반에 언급 했듯이 CPU 수행 단위, 현재 프로세스에서 CPU가 어떤 작업을 바라보고 있는가를 나타낸다.

프로세스 내부에 스레드가 여러개 있다면 스레드끼리 리소스를 공유할 수 있다. 프로세스의 문맥 교환과 비교하면 오버헤드가 적다.

스레드는 CPU 수행 단위이기 때문에 program counter, register set, stack space를 스레드마다 별도로 가지고 있어야 한다. 이 부분 이외의 모든 것을 스레드끼리 공유한다.  

스레드가 동료 스레드와 공유하는 부분은 다음과 같다.
- code section
- data sectino
- OS resources

## 스레드의 장점

- 응답성이 좋다(Responsiveness)
    - 다중 스레드로 구성된 태스크 구조에서는 하나의 서버 스레드가 blocked(waiting) 상태인 동안에도 동일한 태스크 내의 다른 스레드가 실행(running)되어 빠른 처리를 할 수 있다.(하나의 스레드가 사용자 요청 작업을 처리하는 동안 다른 스레드가 해당 작업 처리 과정을 실시간으로 보여줄 수 있다)

- 자원 공유(Resource Sharing)
    - 동일한 일을 수행하는 다중 스레드가 협력하여 높은 처리율(throughput)과 성능 향상을 얻을 수 있다.

- 스레드를 사용하면 병렬성을 높일 수 있다. 여러 스레드가 각각 다른 작업을 수행하면 작업 효율이 높다.

## 출처

- [운영체제](http://www.kocw.net/home/cview.do?cid=4b9cd4c7178db077)