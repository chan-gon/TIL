# 프로세스 관리

운영체제에서 프로그램을 실행 시키면 해당 프로그램이 메모리에 올라가서 프로세스가 되는데, 조금 더 자세히 말하자면, 프로세스 주소 공간(Process Address Space)이 메모리에 할당된다.

**프로그램 실행 -> 프로세스가 메모리에 올라감** 이 과정을 좀 더 세부정으로 바라보면 다음과 같다.

1. 프로그램 실행

2. 가상 메모리(Virtual Memory)에서 프로세스 생성

3. 가상 메모리의 프로세스는 주소 변환(Address Transition)을 통해 물리 메모리(Physical Memory)에 저장된다.

프로그램의 가상 메모리는 Code, Data, Stack 세 부분으로 구성되어 있다.

- Code: 실행 파일의 코드를 관리하는 부분. CPU에서 수행할 기계어들이 여기에 있다.

- Data: 전역변수나 프로그램의 시작-종료 시점까지 남아있는 데이터를 관리한다.

- Stack: 함수나 지역변수를 관리한다.

## 프로세스의 개념

프로세스는 **실행 중인 프로그램(Program in execution)** 이라고 할 수 있다.

프로세스는 문맥(Context) 이라는 것을 가지고 있는데, 해당 프로세스가 현재 어떤 상태에 있는가를 나타낸다.  
문맥에 영향을 미치는 요소는 다양하다. CPU 및 메모리 사용 정도, 파일을 몇 개 열어놓고 사용 했는가/하고 있는가 등등 매우 다양하다.  

## 프로세스의 상태

프로세스는 상태(state)가 변경되며 수행된다.

- Running: CPU를 잡고 instruction을 수행중인 상태

- Ready: CPU를 기다리는 상태(메모리 등 다른 조건을 모두 만족. CPU 사용을 위한 모든 준비가 끝난 상태)

- Blocked(wait, sleep)
    - CPU를 잡아도 당장 instruction을 수행할 수 없는 상태
    - 프로세스 자신이 요청한 event(예: I/O)가 즉시 만족되지 않아 이를 기다리는 상태
    - ex) 디스크에서 파일을 읽어와야 하는 경우(디스크에서 파일을 읽는 것은 오래 걸리는 작업이기 때문에 CPU를 잡아도 무의미함)

- New: 프로세스가 생성중인 상태

- Terminated: 수행(execution)이 끝난 상태

## 문맥 교환(Context Switch)

- CPU를 한 프로세스에서 다른 프로세스로 넘겨주는 과정

CPU가 다른 프로세스에게 넘어갈 때 운영체제는 다음을 수행한다.

- CPU를 내어주는 프로세스의 상태를 그 프로세스의 PCB에 저장
- CPU를 새롭게 얻는 프로세스의 상태를 PCB에서 읽어옴

PCB에 CPU를 넘겨주기 전 프로세스의 마지막 상태 정보를 저장했다가, 다음에 다시 해당 프로세스가 CPU를 가져오면 PCB에 저장된 상태 정보를 가지고 이어서 프로세스가 실행된다.

PCB: 운영체제가 각 프로세스를 관리하기 위해 프로세스당 유지하는 정보. 구성요소는 아래와 같다.  
- OS가 관리상 사용하는 정보  
- CPU 수행 관련 하드웨어 값(Program counter, registers)  
- 메모리 관련(Code, Data, Stack의 위치 정보)
- 파일 관련